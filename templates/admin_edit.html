{% extends "layout.html" %}

{% block title %}Admin | Edit Item{% endblock %}

{% block content %}
<main class="report-container">
    
    <form method="POST" action="{{ url_for('admin_edit', item_id=item['id']) }}">

        <div class="form-group">
            <label for="item-title-found">ของที่พบ/เจอคืออะไร? (ID: {{ item['id'] }})</label>
            <input type="text" id="item-title-found" name="title" value="{{ item['title'] }}" required>
        </div>

        <div class="form-group">
            <label for="item-description-found">รายละเอียดสิ่งของที่พบ (Description)</label>
            <textarea id="item-description-found" name="description" rows="4" required>{{ item['description'] }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="map">ปักหมุดสถานที่ (ลากหมุดไปวางได้)</label>
            <div id="map"></div>
            <input type="hidden" id="latitude" name="latitude" value="{{ item['latitude'] }}" required>
            <input type="hidden" id="longitude" name="longitude" value="{{ item['longitude'] }}" required>
        </div>

        <div class="form-group">
            <label for="item-location-details">รายละเอียดสถานที่ (Text)</label>
            <input type="text" id="item-location-details" name="location" 
                   value="{{ item['location'] or '' }}" 
                   placeholder="เช่น บนโต๊ะหินอ่อน, หน้าห้องน้ำตึก 3 ...">
        </div>

        <div class="form-group">
            <label for="item-date-found">วันเวลาที่พบเจอ</label>
            <input type="date" id="item-date-found" name="date" value="{{ item['date'] }}" required>
        </div>
        
        <div class="form-group">
            <label for="item-type-admin">Type (Lost/Found)</label>
            <select id="item-type-admin" name="type" required>
                <option value="Lost" {% if item['type'] == 'Lost' %}selected{% endif %}>
                    Lost
                </option>
                <option value="Found" {% if item['type'] == 'Found' %}selected{% endif %}>
                    Found
                </option>
            </select>
        </div>

        <button type="submit" id="submit-button-found">Update Item</button>
        
        <a href="{{ url_for('admin_manage') }}" style="display: block; text-align: center; margin-top: 1rem; color: var(--muted);">
            Cancel
        </a>
    </form>
</main>
{% endblock %}


{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const itemLat = {{ item['latitude'] or 13.730786908906376 }};
        const itemLng = {{ item['longitude'] or 100.78121423721315 }};

        const latInput = document.getElementById('latitude');
        const lngInput = document.getElementById('longitude');

        const map = L.map('map').setView([itemLat, itemLng], 15);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        const marker = L.marker([itemLat, itemLng], {
            draggable: true
        }).addTo(map);

        marker.on('dragend', function (e) {
            const position = marker.getLatLng();
            latInput.value = position.lat;
            lngInput.value = position.lng;
        });

        if (!latInput.value) {
            latInput.value = itemLat;
        }
        if (!lngInput.value) {
            lngInput.value = itemLng;
        }
    });
</script>
{% endblock %}