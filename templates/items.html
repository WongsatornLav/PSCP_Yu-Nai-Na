{% extends "layout.html" %}
{% block title %}Items | Yu Nai Na{% endblock %}
{% block content %}
<main class="items-page">
  <section class="items-hero">
    <div class="items-hero-inner">
      <h1>All items list</h1>
      <div class="items-search">
        <input type="text" id="search-input" placeholder="Search by title, description, or location...">
      </div>
      <div class="items-filters">
        <button class="filter-btn active" data-filter="all">All Items</button>
        <button class="filter-btn" data-filter="Lost">Lost</button>
        <button class="filter-btn" data-filter="Found">Found</button>
      </div>
    </div>
  </section>

  <section class="items-grid" id="items-grid">
    {% for item in items %}
    <article class="item-card" 
      data-type="{{ item['type'] }}" 
      data-title="{{ item['title']|lower }}"
      data-desc="{{ (item['description'] or '')|lower }}" 
      data-location="{{ (item['location'] or '')|lower }}">

      <div class="item-card-left">
        {% if item["image"] %}
        <img src="{{ url_for('static', filename='uploads/' + item['image']) }}" 
             alt="{{ item['title'] }}" 
             class="item-thumb">
        {% else %}
        <div class="item-thumb placeholder">No image</div>
        {% endif %}
      </div>

      <div class="item-card-body">
        <div class="item-card-top">
          <h2>{{ item["title"] }}</h2>
          {% if item["type"] == "Lost" %}
          <span class="badge badge-lost">LOST</span>
          {% elif item["type"] == "Found" %}
          <span class="badge badge-found">FOUND</span>
          {% endif %}
        </div>

        <p class="item-desc">{{ item["description"] }}</p>

        <div class="item-meta">
          <div class="meta-row">
            <span class="meta-icon">üìç</span>
            <span>{{ item["location"] or "‚Äî" }}</span>
          </div>

          {% if item["contact"] %}
          <div class="meta-row">
            <span class="meta-icon">üìû</span>
            <span>{{ item["contact"] }}</span>
          </div>
          {% endif %}

          <div class="meta-row">
            <span>{{ item["date"] or "‚Äî" }}</span>
          </div>
        </div>
      </div>
    </article>
    {% else %}
    <p style="text-align:center; padding: 40px 0;">No items yet.</p>
    {% endfor %}
  </section>
</main>

<script>
  const filterBtns = document.querySelectorAll('.filter-btn');
  const cards = document.querySelectorAll('.item-card');
  const searchInput = document.getElementById('search-input');

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.dataset.filter;
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      cards.forEach(card => {
        const type = card.dataset.type;
        const matchesType = (filter === 'all') || (type === filter);
        card.dataset.hiddenByFilter = matchesType ? '0' : '1';
        card.style.display = matchesType ? 'flex' : 'none';
      });

      applySearch();
    });
  });

  function applySearch() {
    const q = searchInput.value.toLowerCase();
    cards.forEach(card => {
      const inTitle = card.dataset.title.includes(q);
      const inDesc = card.dataset.desc.includes(q);
      const inLoc = card.dataset.location.includes(q);
      const hiddenByFilter = card.dataset.hiddenByFilter === '1';
      if (hiddenByFilter) return;
      card.style.display = (inTitle || inDesc || inLoc) ? 'flex' : 'none';
    });
  }

  searchInput.addEventListener('input', applySearch);
</script>
{% endblock %}
