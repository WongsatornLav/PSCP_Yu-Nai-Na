{% extends "layout.html" %}
{% block title %}Items | Lost & Found{% endblock %}

{% block content %}
<main class="items-page">

  <!-- Hero / Header -->
  <section class="items-hero">
    <div class="items-hero-inner">
      <h1>All items list</h1>

      <!-- Search -->
      <div class="items-search">
        <input type="text" id="search-input" placeholder="Search by title, description, or location...">
      </div>

      <!-- Filters -->
      <div class="items-filters">
        <button class="filter-btn active" data-filter="all">All Items</button>
        <button class="filter-btn" data-filter="Lost">Lost</button>
        <button class="filter-btn" data-filter="Found">Found</button>
      </div>
    </div>
  </section>

  <!-- Cards -->
  <section class="items-grid" id="items-grid">
    {% for item in items %}
      <article class="item-card" 
               data-type="{{ item['type'] }}"
               data-title="{{ item['title']|lower }}"
               data-desc="{{ (item['description'] or '')|lower }}"
               data-location="{{ (item['location'] or '')|lower }}">
        <div class="item-card-top">
          <h2>{{ item["title"] }}</h2>
          {% if item["type"] == "Lost" %}
            <span class="badge badge-lost">lost</span>
          {% elif item["type"] == "Found" %}
            <span class="badge badge-found">found</span>
          {% else %}
            <span class="badge">other</span>
          {% endif %}
        </div>
        <p class="item-desc">{{ item["description"] }}</p>

        <div class="item-meta">
          <div class="meta-row">
            <span class="meta-icon">üìç</span>
            <span>{{ item["location"] or "‚Äî" }}</span>
          </div>
          <div class="meta-row">
            <span class="meta-icon">üìÖ</span>
            <span>{{ item["date"] or "‚Äî" }}</span>
          </div>
        </div>
      </article>
    {% else %}
      <p style="text-align:center; padding: 40px 0;">No items yet.</p>
    {% endfor %}
  </section>

</main>

<!-- tiny JS for filter + search -->
<script>
  const filterBtns = document.querySelectorAll('.filter-btn');
  const cards = document.querySelectorAll('.item-card');
  const searchInput = document.getElementById('search-input');

  // filter buttons
  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.dataset.filter;
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      cards.forEach(card => {
        const type = card.dataset.type;
        const matchesType = (filter === 'all') || (type === filter);
        card.style.display = matchesType ? 'block' : 'none';
      });

      // also re-apply search after filter
      applySearch();
    });
  });

  // search
  function applySearch() {
    const q = searchInput.value.toLowerCase();
    cards.forEach(card => {
      const inTitle = card.dataset.title.includes(q);
      const inDesc = card.dataset.desc.includes(q);
      const inLoc = card.dataset.location.includes(q);

      // only show if currently visible by filter
      const currentlyHiddenByFilter = card.style.display === 'none';
      if (currentlyHiddenByFilter && q === '') return;

      if (inTitle || inDesc || inLoc) {
        if (card.dataset._hiddenByFilter !== '1') {
          card.style.display = 'block';
        }
      } else {
        card.style.display = 'none';
      }
    });
  }

  searchInput.addEventListener('input', applySearch);
</script>
{% endblock %}
